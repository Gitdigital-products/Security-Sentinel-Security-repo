
#!/usr/bin/env python3
"""
Simple stub scanner: reads rules.yml and scans files for basic patterns.
"""
import yaml
import sys
from pathlib import Path
import re

RULES_PATH = Path('rules.yml')

def load_rules():
    if not RULES_PATH.exists():
        print('No rules.yml found.')
        sys.exit(1)
    return yaml.safe_load(RULES_PATH)

def scan_path(p):
    issues = []
    for f in Path(p).rglob('*.*'):
        if f.match('node_modules/*') or f.match('dist/*'):
            continue
        try:
            text = f.read_text(errors='ignore')
            for r in rules.get('security_rules', []):
                if re.search(r.get('pattern',''), text, re.IGNORECASE):
                    issues.append({'file': str(f), 'rule': r['id'], 'name': r['name']})
        except Exception:
            pass
    return issues

if __name__ == '__main__':
    rules = load_rules()
    path = sys.argv[1] if len(sys.argv) > 1 else '.'
    issues = scan_path(path)
    print(f"Found {len(issues)} issues")
    for i in issues[:200]:
        print(i)